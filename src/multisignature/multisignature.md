---
# Мультиподпись
---

В случае с криптовалютами мультиподпись (multisig) позволяет подписывать транзакции, используя более одного приватного ключа. Средства, защищённые мультиподписью, могут быть потрачены, только если для подписания имеется «M из N» ключей.

Вот некоторые примеры использования этой схемы:

* совместно используемый счёт (1 из 2; муж и жена — оба обладают полным доступом к средствам);
* согласованно используемый счёт (2 из 2; муж и жена должны согласовать трату средств);
* «пороговый» счёт (2 из 3; в качестве независимой третьей стороны привлекается эскроу-служба, которая подписывает транзакцию либо вместе с продавцом, либо с покупателем, если продавцу и покупателю не удаётся договориться);
* безопасный счёт (2 из 3; один владелец контролирует все три ключа, но обеспечивает их безопасность различными средствами, чтобы диверсифицировать риски);
* произвольный пороговый счёт (M из N; некоторые криптовалюты обеспечивают совершенную гибкость с точки зрения количества подписантов).

## Мультиподпись Monero

Monero не использует мультиподписи напрямую (по крайней мере в классическом понимании этой схемы). В данном случае схема multisig имитируется путём секретного разделения.

Транзакции по-прежнему подписываются при помощи одного ключа траты. Ключ траты представляет собой сумму всех N приватных ключей. Обоснование такого решения строится на необходимости отделения мультиподписей от кольцевых.

Давайте рассмотрим схему «2 из 3». У нас есть три участника. Каждый из участников получает по два приватных ключа, при этом пары не повторяются между участниками. Таким образом, пара участников вместе обладает всеми тремя приватными ключами, необходимыми для создания приватного ключа траты.

Использование мультиподписи является опцией, реализуемой на уровне кошелька. Вы никогда не сможете узнать, основываясь на данных блокчейна, какие транзакции были подписаны при помощи мультиподписи.

Также стоит отметить, что в случае Monero multisig-адреса отсутствуют как таковые. [Структура адреса](https://wiki.xmr.ru/address/standard-address.html#%D0%A1%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D0%B0-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85) никак не зависит от того, как был создан лежащий в её основе приватный ключ траты.

После настройки multisig-кошелька каждому участнику становится известен публичный адрес и приватный ключ просмотра. Это необходимо для того, чтобы участники смогли распознать и расшифровать транзакции, которые будут подписаны ими совместно.

## Настройка multisig-кошелька

Схема multisig может использоваться только при использовании кошелька с поддержкой командной строки (CLI). Перед тем как вы решите воспользоваться мультиподписью, следует изучить, как работает CLI-кошелёк.

Давайте возьмём в качестве примера схему «2 из 3», поскольку она представляет собой универсальный случай.

### 0. Откройте кошелёк

Зайдите в свой кошелёк (в отладочной (stagenet) сети):

```
./monerod --stagenet --daemon                     # Запустите полный узел; убедитесь в том, что он полностью синхронизирован.  
./monero-wallet-cli --stagenet --wallet-file=...  # Запустите ваш кошелёк; убедитесь, что в нём есть доступные средства.  
```

### 1. Подготовка к созданию multisig-кошелька

Каждый из участников независимо генерирует **данные инициализации, не являющиеся** адресом.

Каждый участник по безопасному каналу «вручную» отправляет свои данные инициализации всем остальным участникам.

### 2. Создание multisig-кошелька

Каждый участник использует данные инициализации, полученные от других участников. В результате происходит **второй раунд** задействования данных инициализации. Но по-прежнему это ещё **не адрес**.

Каждый из участников по безопасному каналу отправляет данные инициализации, использованные во втором раунде, всем остальным участникам.

### 3. Окончание создания multisig-кошелька

В конце создания кошелька каждый участник использует данные инициализации второго раунда, полученные от всех остальных участников. В результате создаются **публичный адрес** и **приватный ключ просмотра** кошелька, известные всем участникам.

Следует отметить, что действия всех участников симметричны. Даже несмотря на то, что в качестве примера нами была рассмотрена схема «2 из 3», каждый участник сотрудничает со всеми остальными участниками. Разделение секрета производится внутри кошелька.

Участники вручную безопасно совместно используют данные инициализации. Сам по себе кошелёк не обеспечивает какого-либо безопасного канала связи. Такая задача не ставится.

## Получение средств

Адрес, созданный при настройке multisig-кошелька, будет таким же, как и любой другой адрес.

На его основе вы можете сгенерировать интегрированные адреса и подадреса.

Все участники могут видеть входящие средства, так как используют общий приватный ключ просмотра.

Для просмотра входящих платежей при использовании CLI-кошелька следует использовать следующие команды:

    address
    refresh
    show_transfers

## Трата средств

Данный материал находится в процессе написания.

## Ссылки

* [https://monero.stackexchange.com/questions/5646/how-to-use-monero-multisignature-wallets-2-2-2-3](https://monero.stackexchange.com/questions/5646/how-to-use-monero-multisignature-wallets-2-2-2-3)
